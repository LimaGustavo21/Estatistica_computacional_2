---
title: "Filas"
output: html_notebook
---

Considere um problema básico de filas em que as chegadas ocorrem segundo uma distribuição exponencial de parâmetro λ1 e os atendimentos segundo segundo uma distribuição exponencial de parâmetro λ2. Supõe-se independência entre as chegadas e atendimentos.

Diferentes cenários podem ser definidos com escolhas de tempo/tamanho da fila, λ1 e λ2.

- 1.Forneça um código para geração das filas e ilustre o uso em diferentes cenários.
- 2.Estude a distribuição amostral do tamanho mediano da fila.
- 3.Estude a distribuição amostral do tamanho máximo da fila.


...............................................................................................................................................................................

### Resolução 


  -   Chegadas:
  
O tempo entre as chegadas de clientes em um sistema de filas é modelado por uma distribuição exponencial, cuja função densidade de probabilidade (PDF) é dada por:

$$
f(t_c) = \lambda e^{-\lambda t_c}, \quad t_c \geq 0
$$


- \( \lambda \) → taxa média de chegadas por **minuto**  
- \( t_c \) → tempo (em minutos) até a próxima chegada





```{r}
lambda <- 5/60 # taxa média de chegada convertida em minutos (5/hora)

rexp(1, rate = lambda)
```



O tempo de atendimento de cada cliente em um sistema de filas é modelado por uma distribuição exponencial, cuja função densidade de probabilidade (PDF) é:

$$
f(t_a) = \lambda_2 e^{-\lambda_2 t_a}, \quad t_a \geq 0
$$


- \( \lambda_2 \) → taxa média de atendimentos por unidade de tempo (por exemplo, por minuto ou por hora)  
- \( t_a \) → tempo de atendimento de um cliente  

```{r}
lambda2 <- 5/60 # taxa média de atendimento convertida em minutos (5/hora)

rexp(1, rate = lambda2)
```


Dado que as chegadas independem do tempo de atendimento, podemos gerar a simulação de um dia de expediente com os períodos de chegada 

```{r}
tempo_total <- 0
chegadas <- c()

tempo_limite <- 600 # 10horas de expediente



while (tempo_total < tempo_limite) {
  tempo_proxima_chegada <- rexp(1, rate = lambda)
  tempo_total <- tempo_total + tempo_proxima_chegada
  if (tempo_total <= tempo_limite) {
    chegadas <- c(chegadas, tempo_total)
  }
}
chegadas
(Total_chegadas <- length(chegadas)) 
```
Definido a quantidade de pessoas que chegaram, podemos gerar agora o tempo de cada atendimento


```{r}
(tempo_atendimento <- rexp(Total_chegadas, rate = lambda2))
```
como definir a fila ? 

```{r}
#Início - atendimento 1 
atendimentos_feitos <- 0
fila_atual <- 0 

fim_atendimento <-  numeric(Total_chegadas)


(inicio_atendimento <- chegadas[1])

(tempo_atendimento[1])

(fim_atendimento[1] <- inicio_atendimento + tempo_atendimento[1])






#Atendimento 2

chegadas[2]

(atendimentos_feitos <- sum(fim_atendimento <= chegadas[2] & fim_atendimento > 0))

(fila_atual <- 1 - atendimentos_feitos)


(inicio_atendimento <- max(max(fim_atendimento) ,chegadas[2]))

(tempo_atendimento[2])

(fim_atendimento[2] <- inicio_atendimento + tempo_atendimento[2])


#Atendimento 3

chegadas[3]

(atendimentos_feitos <- sum(fim_atendimento <= chegadas[3] & fim_atendimento > 0))

(fila_atual <- 2 - atendimentos_feitos)


(inicio_atendimento <- max(max(fim_atendimento) ,chegadas[3]))

(tempo_atendimento[3])

(fim_atendimento[3] <- inicio_atendimento + tempo_atendimento[3])

fim_atendimento

```






```{r}
sim_fila <- function(lambda_chegada, lambda_atendimento, tempo_expediente){
  
  tempo_total <- 0
  chegadas <- c()



  #Gerar chegadas em um dia de expediente
  while (tempo_total < tempo_expediente) {
    tempo_proxima_chegada <- rexp(1, rate = lambda_chegada)
    tempo_total <- tempo_total + tempo_proxima_chegada
    if (tempo_total <= tempo_expediente) {
      chegadas <- c(chegadas, tempo_total)
    }
  }
  
  #Total de chegadas no dia 
  Total_chegadas <- length(chegadas)
  
  
  #Gerar tempo de atendimento para cada chegada
  tempo_atendimento <- rexp(Total_chegadas, rate = lambda_atendimento)
  
  #Primeiro atendimento
  
  inicio_atendimento <-  numeric(Total_chegadas)
  fim_atendimento <-  numeric(Total_chegadas)
  fila_atual <-  numeric(Total_chegadas)
  
 


  inicio_atendimento[1] <- chegadas[1]

  atendimentos_feitos <- 0
  fila_atual[1] <- 0

  fim_atendimento[1] <- inicio_atendimento[1] + tempo_atendimento[1]
  
  for (i in 2:Total_chegadas){
    

    atendimentos_feitos <- sum(fim_atendimento <= chegadas[i] & fim_atendimento > 0)

    fila_atual[i] <- (i-1) - atendimentos_feitos


    inicio_atendimento[i] <- max(max(fim_atendimento) ,chegadas[i])



    fim_atendimento[i] <- inicio_atendimento[i] + tempo_atendimento[i]


    
  }
  
  return (fila_atual)
  
}
```

```{r}
fila <- sim_fila(5/60,4/60,600)


plot(fila)
```

 #### 1.Forneça um código para geração das filas e ilustre o uso em diferentes cenários.
 
 
```{r}
atend_menor <-  sim_fila(lambda_chegada = 5/60,
                         lambda_atendimento = 3/60,
                          tempo_expediente = 600)


atend_igual <-  sim_fila(lambda_chegada = 5/60,
                         lambda_atendimento = 5/60,
                          tempo_expediente = 600)


atend_maior <-  sim_fila(lambda_chegada = 5/60,
                         lambda_atendimento = 7/60,
                          tempo_expediente = 600)


plot(atend_menor, type = "l", col = "red", lwd = 2,
     xlab = "Ordem de chegada", ylab = "Tamanho da fila",
     main = "Comparativo de Tamanho da Fila em Diferentes Cenários",
     ylim = range(c(atend_menor, atend_igual, atend_maior)))  # para ajustar o eixo y

# Adicionar as outras duas linhas no mesmo gráfico
lines(atend_igual, col = "blue", lwd = 2)
lines(atend_maior, col = "green", lwd = 2)



```
 



```{r}
# Simulações — 3 de cada cenário
atend_menor_1 <- sim_fila(lambda_chegada = 10/60, lambda_atendimento = 5/60, tempo_expediente = 600)
atend_menor_2 <- sim_fila(lambda_chegada = 10/60, lambda_atendimento = 5/60, tempo_expediente = 600)
atend_menor_3 <- sim_fila(lambda_chegada = 10/60, lambda_atendimento = 5/60, tempo_expediente = 600)
atend_menor_4 <- sim_fila(lambda_chegada = 10/60, lambda_atendimento = 5/60, tempo_expediente = 600)
atend_menor_5 <- sim_fila(lambda_chegada = 10/60, lambda_atendimento = 5/60, tempo_expediente = 600)

atend_igual_1 <- sim_fila(lambda_chegada = 10/60, lambda_atendimento = 10/60, tempo_expediente = 600)
atend_igual_2 <- sim_fila(lambda_chegada = 10/60, lambda_atendimento = 10/60, tempo_expediente = 600)
atend_igual_3 <- sim_fila(lambda_chegada = 10/60, lambda_atendimento = 10/60, tempo_expediente = 600)
atend_igual_4 <- sim_fila(lambda_chegada = 10/60, lambda_atendimento = 10/60, tempo_expediente = 600)
atend_igual_5 <- sim_fila(lambda_chegada = 10/60, lambda_atendimento = 10/60, tempo_expediente = 600)

atend_maior_1 <- sim_fila(lambda_chegada = 10/60, lambda_atendimento = 15/60, tempo_expediente = 600)
atend_maior_2 <- sim_fila(lambda_chegada = 10/60, lambda_atendimento = 15/60, tempo_expediente = 600)
atend_maior_3 <- sim_fila(lambda_chegada = 10/60, lambda_atendimento = 15/60, tempo_expediente = 600)
atend_maior_4 <- sim_fila(lambda_chegada = 10/60, lambda_atendimento = 15/60, tempo_expediente = 600)
atend_maior_5 <- sim_fila(lambda_chegada = 10/60, lambda_atendimento = 15/60, tempo_expediente = 600)


ylim_total <- range(c(atend_menor_1, atend_menor_2, atend_menor_3, atend_menor_4, atend_menor_5,
                      atend_igual_1, atend_igual_2, atend_igual_3, atend_igual_4, atend_igual_5,
                      atend_maior_1, atend_maior_2, atend_maior_3, atend_maior_4, atend_maior_5))

plot(atend_menor_1, type = "l", col = "red", lwd = 2,
     ylim = ylim_total,
     xlab = "Ordem de chegada", ylab = "Tamanho da fila",
     main = "Comparativo de 3 simulações por cenário")

# Adicionar as demais
lines(atend_menor_2, col = "red", lwd = 2)
lines(atend_menor_3, col = "red", lwd = 2)
lines(atend_menor_4, col = "red", lwd = 2)
lines(atend_menor_5, col = "red", lwd = 2)

lines(atend_igual_1, col = "blue", lwd = 2)
lines(atend_igual_2, col = "blue", lwd = 2)
lines(atend_igual_3, col = "blue", lwd = 2)
lines(atend_igual_4, col = "blue", lwd = 2)
lines(atend_igual_5, col = "blue", lwd = 2)

lines(atend_maior_1, col = "green", lwd = 2)
lines(atend_maior_2, col = "green", lwd = 2)
lines(atend_maior_3, col = "green", lwd = 2)
lines(atend_maior_4, col = "green", lwd = 2)
lines(atend_maior_5, col = "green", lwd = 2)

# Adicionar legenda

```

```{r}
# Definir layout de 2x2 plots
par(mfrow = c(2, 2))

# Gráfico 1 — todos os cenários juntos
plot(atend_menor_1, type = "l", col = "red", lwd = 2, ylim = ylim_total,
     main = "Todas as simulações", xlab = "Ordem", ylab = "Tamanho da fila")
lines(atend_menor_2, col = "red", lwd = 2)
lines(atend_menor_3, col = "red", lwd = 2)
lines(atend_menor_4, col = "red", lwd = 2)
lines(atend_menor_5, col = "red", lwd = 2)

lines(atend_igual_1, col = "blue", lwd = 2)
lines(atend_igual_2, col = "blue", lwd = 2)
lines(atend_igual_3, col = "blue", lwd = 2)
lines(atend_igual_4, col = "blue", lwd = 2)
lines(atend_igual_5, col = "blue", lwd = 2)

lines(atend_maior_1, col = "green", lwd = 2)
lines(atend_maior_2, col = "green", lwd = 2)
lines(atend_maior_3, col = "green", lwd = 2)
lines(atend_maior_4, col = "green", lwd = 2)
lines(atend_maior_5, col = "green", lwd = 2)

# Gráfico 2 — Atendimentos Menor
plot(atend_menor_1, type = "l", col = "red", lwd = 2, ylim = ylim_total,
     main = "Atendimento Menor", xlab = "Ordem", ylab = "Tamanho da fila")
lines(atend_menor_2, col = "red", lwd = 2)
lines(atend_menor_3, col = "red", lwd = 2)
lines(atend_menor_4, col = "red", lwd = 2)
lines(atend_menor_5, col = "red", lwd = 2)

# Gráfico 3 — Atendimento Igual
plot(atend_igual_1, type = "l", col = "blue", lwd = 2, ylim = ylim_total,
     main = "Atendimento Igual", xlab = "Ordem", ylab = "Tamanho da fila")
lines(atend_igual_2, col = "blue", lwd = 2)
lines(atend_igual_3, col = "blue", lwd = 2)
lines(atend_igual_4, col = "blue", lwd = 2)
lines(atend_igual_5, col = "blue", lwd = 2)

# Gráfico 4 — Atendimento Maior
plot(atend_maior_1, type = "l", col = "green", lwd = 2, ylim = ylim_total,
     main = "Atendimento Maior", xlab = "Ordem", ylab = "Tamanho da fila")
lines(atend_maior_2, col = "green", lwd = 2)
lines(atend_maior_3, col = "green", lwd = 2)
lines(atend_maior_4, col = "green", lwd = 2)
lines(atend_maior_5, col = "green", lwd = 2)

# Reset layout
par(mfrow = c(1, 1))
```

#### Estude a distribuição amostral do tamanho mediano da fila.


```{r}
med_tend_maior <- replicate(10000, median(sim_fila(lambda_chegada = 10/60,
                                                lambda_atendimento = 5/60,
                                                tempo_expediente = 600)))


hist(med_tend_maior)
```

```{r}
max_tend_maior <- replicate(10000, max(sim_fila(lambda_chegada = 10/60,
                                                lambda_atendimento = 5/60,
                                                tempo_expediente = 600)))


hist(max_tend_maior)
```









